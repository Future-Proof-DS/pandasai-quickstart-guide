2025-10-28 07:10:00 [INFO] Question: How many users are there?
2025-10-28 07:10:00 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:10:00 [INFO] Prompt ID: 55524870-281e-4715-af8f-bcf2cabe897e
2025-10-28 07:10:00 [INFO] Generating new code...
2025-10-28 07:10:00 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:10:00 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:10:00 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] Retrying Code Generation (1/3)...
2025-10-28 07:10:00 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:10:00 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] Retrying Code Generation (2/3)...
2025-10-28 07:10:00 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:10:00 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] Retrying Code Generation (3/3)...
2025-10-28 07:10:00 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:10:00 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:10:00 [INFO] Maximum retry attempts exceeded. Last error: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:18:00 [INFO] Question: How many users are there?
2025-10-28 07:18:01 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:18:01 [INFO] Prompt ID: 79f1bc34-8989-4cf4-a116-e1eeb2482fe2
2025-10-28 07:18:01 [INFO] Generating new code...
2025-10-28 07:18:01 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:18:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:18:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] Retrying Code Generation (1/3)...
2025-10-28 07:18:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:18:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] Retrying Code Generation (2/3)...
2025-10-28 07:18:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:18:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] Retrying Code Generation (3/3)...
2025-10-28 07:18:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:18:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:18:01 [INFO] Maximum retry attempts exceeded. Last error: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:07 [INFO] Question: How many users are there?
2025-10-28 07:21:07 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:21:07 [INFO] Prompt ID: 982697ec-8214-481d-a033-52b4291c7f95
2025-10-28 07:21:07 [INFO] Generating new code...
2025-10-28 07:21:07 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:07 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:07 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:07 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:07 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:07 [INFO] Retrying Code Generation (1/3)...
2025-10-28 07:21:07 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:08 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:08 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:08 [INFO] Retrying Code Generation (2/3)...
2025-10-28 07:21:08 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:08 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:08 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:08 [INFO] Retrying Code Generation (3/3)...
2025-10-28 07:21:08 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:08 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:08 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:08 [INFO] Maximum retry attempts exceeded. Last error: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:39 [INFO] Question: How many users are there?
2025-10-28 07:21:39 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:21:39 [INFO] Prompt ID: b79849f1-e8f4-4ce3-8e24-b325709a727b
2025-10-28 07:21:39 [INFO] Generating new code...
2025-10-28 07:21:39 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:39 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:39 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] Retrying Code Generation (1/3)...
2025-10-28 07:21:39 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:39 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] Retrying Code Generation (2/3)...
2025-10-28 07:21:39 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:39 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] Retrying Code Generation (3/3)...
2025-10-28 07:21:39 [INFO] Execution failed with error: Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] An error occurred during code generation: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:21:39 [INFO] Stack Trace:
Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 176, in generate_code_with_retries
    return self.generate_code(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/agent/base.py", line 119, in generate_code
    code = self._code_generator.generate_code(prompt)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 52, in generate_code
    raise e
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/generate_python_code_with_sql.tmpl", line 3, in top-level template code
    {% include 'shared/dataframe.tmpl' with context %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 53, in execute_query
    return load_function(connection_info, query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai_sql/__init__.py", line 33, in load_from_postgres
    conn = psycopg2.connect(
           ^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/psycopg2/__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: could not translate host name "${DB_HOST}" to address: nodename nor servname provided, or not known


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/code_generation/base.py", line 30, in generate_code
    self._context.logger.log(f"Using Prompt: {prompt}")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 56, in __str__
    return self.to_string()
           ^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/base.py", line 51, in to_string
    self._resolved_prompt = self.prompt.render(**self.props)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/correct_execute_sql_query_usage_error_prompt.tmpl", line 1, in top-level template code
    {% for df in context.dfs %}{% include 'shared/dataframe.tmpl' with context %}{% endfor %}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/core/prompts/templates/shared/dataframe.tmpl", line 1, in top-level template code
    {{ df.serialize_dataframe() }}
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/base.py", line 152, in serialize_dataframe
    return DataframeSerializer.serialize(self, dialect)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/helpers/dataframe_serializer.py", line 35, in serialize
    dataframe_info += f' dimensions="{df.rows_count}x{df.columns_count}">'
                                      ^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/dataframe/virtual_dataframe.py", line 44, in rows_count
    return self._loader.get_row_count()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 84, in get_row_count
    result = self.execute_query(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/andresvourakis/Library/Caches/pypoetry/virtualenvs/pandasai-introduction-o9yHhBPq-py3.11/lib/python3.11/site-packages/pandasai/data_loader/sql_loader.py", line 61, in execute_query
    raise RuntimeError(
RuntimeError: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users

2025-10-28 07:21:39 [INFO] Maximum retry attempts exceeded. Last error: Failed to execute query for 'postgres' with: SELECT
  COUNT(*)
FROM users
2025-10-28 07:23:31 [INFO] Question: How many users are there?
2025-10-28 07:23:31 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:23:31 [INFO] Prompt ID: 0eb32d83-8792-4b2e-ae2b-37136e859f30
2025-10-28 07:23:31 [INFO] Generating new code...
2025-10-28 07:23:33 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 How many users are there?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-28 07:23:37 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to count the number of users
sql_query = "SELECT COUNT(*) AS user_count FROM users;"

# Execute the query
df = execute_sql_query(sql_query)

# Extract the count value
user_count = df.at[0, "user_count"]

# Declare result var:
result = { "type": "number", "value": user_count }
2025-10-28 07:23:37 [INFO] Validating code requirements...
2025-10-28 07:23:37 [INFO] Code validation successful.
2025-10-28 07:23:37 [INFO] Cleaning the generated code...
2025-10-28 07:23:37 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT COUNT(*) AS user_count FROM users'
df = execute_sql_query(sql_query)
user_count = df.at[0, 'user_count']
result = {'type': 'number', 'value': user_count}
2025-10-28 07:23:39 [INFO] Response generated successfully.
2025-10-28 07:25:04 [INFO] Question: What is the most popular device type per country?
2025-10-28 07:25:04 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:25:04 [INFO] Prompt ID: e9deaab4-1798-4653-ab02-c1dc2696a648
2025-10-28 07:25:04 [INFO] Generating new code...
2025-10-28 07:25:06 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = 'SELECT COUNT(*) AS user_count FROM users'
df = execute_sql_query(sql_query)
user_count = df.at[0, 'user_count']
result = {'type': 'number', 'value': user_count}



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-28 07:25:09 [INFO] Code Generated:
import pandas as pd

sql_query = """
SELECT country, device_type,
       COUNT(*) AS device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""

df = execute_sql_query(sql_query)

# For each country, keep only the device_type with the highest count
df = df.sort_values(['country', 'device_count'], ascending=[True, False])
df_most_popular = df.groupby('country').first().reset_index()

result = {"type": "dataframe", "value": df_most_popular}
2025-10-28 07:25:09 [INFO] Validating code requirements...
2025-10-28 07:25:09 [INFO] Code validation successful.
2025-10-28 07:25:09 [INFO] Cleaning the generated code...
2025-10-28 07:25:09 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type,
       COUNT(*) AS device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""
df = execute_sql_query(sql_query)
df = df.sort_values(['country', 'device_count'], ascending=[True, False])
df_most_popular = df.groupby('country').first().reset_index()
result = {'type': 'dataframe', 'value': df_most_popular}
2025-10-28 07:25:10 [INFO] Response generated successfully.
2025-10-28 07:38:27 [INFO] Question: What is the most popular device type per country?
2025-10-28 07:38:27 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:38:27 [INFO] Prompt ID: b9d505c0-1382-4722-b33d-692e686c4b5a
2025-10-28 07:38:27 [INFO] Generating new code...
2025-10-28 07:38:27 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-28 07:38:31 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, cnt FROM (
    SELECT 
        country, 
        device_type, 
        COUNT(*) as cnt,
        RANK() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) as rnk
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) WHERE rnk = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = { "type": "dataframe", "value": df }
2025-10-28 07:38:31 [INFO] Validating code requirements...
2025-10-28 07:38:31 [INFO] Code validation successful.
2025-10-28 07:38:31 [INFO] Cleaning the generated code...
2025-10-28 07:38:31 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, cnt FROM (
    SELECT 
        country, 
        device_type, 
        COUNT(*) as cnt,
        RANK() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) as rnk
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) WHERE rnk = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-28 07:38:31 [INFO] Response generated successfully.
2025-10-28 07:39:10 [INFO] Question: What is the most popular device type per country?
2025-10-28 07:39:10 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:39:10 [INFO] Prompt ID: ef83629a-e2ac-4b4a-bcdf-b53ab6ca3962
2025-10-28 07:39:10 [INFO] Generating new code...
2025-10-28 07:39:10 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-28 07:39:13 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = { "type": "dataframe", "value": df }
2025-10-28 07:39:13 [INFO] Validating code requirements...
2025-10-28 07:39:13 [INFO] Code validation successful.
2025-10-28 07:39:13 [INFO] Cleaning the generated code...
2025-10-28 07:39:13 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-28 07:39:13 [INFO] Response generated successfully.
2025-10-28 07:40:15 [INFO] Question: What is the most popular device type per country?
2025-10-28 07:40:15 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:40:15 [INFO] Prompt ID: 7f90b66e-e7ff-4940-b39b-8937e5743df0
2025-10-28 07:40:15 [INFO] Generating new code...
2025-10-28 07:40:15 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-28 07:40:18 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to find the most popular device type per country
sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS device_count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
),
ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        device_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) as rn
    FROM device_counts
)
SELECT country, device_type, device_count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""

# Execute SQL query and get result as DataFrame
df_result = execute_sql_query(sql_query)

# Declare result variable
result = { "type": "dataframe", "value": df_result }
2025-10-28 07:40:18 [INFO] Validating code requirements...
2025-10-28 07:40:18 [INFO] Code validation successful.
2025-10-28 07:40:18 [INFO] Cleaning the generated code...
2025-10-28 07:40:19 [INFO] Executing code: import pandas as pd
sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS device_count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
),
ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        device_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) as rn
    FROM device_counts
)
SELECT country, device_type, device_count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""
df_result = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_result}
2025-10-28 07:40:19 [INFO] Response generated successfully.
2025-10-28 07:40:19 [INFO] Question: What is the most popular device type per country?
2025-10-28 07:40:19 [INFO] Running PandasAI with litellm LLM...
2025-10-28 07:40:19 [INFO] Prompt ID: 5cd0547f-7d70-4a54-9598-8283c9c5cfdc
2025-10-28 07:40:19 [INFO] Generating new code...
2025-10-28 07:40:21 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-28 07:40:25 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to find the most popular device type per country
sql_query = """
SELECT country, device_type, count(*) AS device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""

# Execute the query and load the result into a dataframe
df = execute_sql_query(sql_query)

# For each country, get the device_type with the highest count
idx = df.groupby('country')['device_count'].idxmax()
most_popular_devices = df.loc[idx].reset_index(drop=True)

# Declare result var:
result = { "type": "dataframe", "value": most_popular_devices }
2025-10-28 07:40:25 [INFO] Validating code requirements...
2025-10-28 07:40:25 [INFO] Code validation successful.
2025-10-28 07:40:25 [INFO] Cleaning the generated code...
2025-10-28 07:40:25 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, count(*) AS device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""
df = execute_sql_query(sql_query)
idx = df.groupby('country')['device_count'].idxmax()
most_popular_devices = df.loc[idx].reset_index(drop=True)
result = {'type': 'dataframe', 'value': most_popular_devices}
2025-10-28 07:40:26 [INFO] Response generated successfully.
2025-10-29 14:36:56 [INFO] Question: What is the most popular device type per country?
2025-10-29 14:36:56 [INFO] Running PandasAI with litellm LLM...
2025-10-29 14:36:56 [INFO] Prompt ID: b4e0bd8a-795e-480b-ad7c-d8d71b8bd185
2025-10-29 14:36:56 [INFO] Generating new code...
2025-10-29 14:36:56 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 14:37:01 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to find the most popular device type per country
sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
), ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY count DESC) AS rn
    FROM device_counts
)
SELECT country, device_type, count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""

# Execute the query
df_popular_devices = execute_sql_query(sql_query)

# Declare result var
result = { "type": "dataframe", "value": df_popular_devices }
2025-10-29 14:37:01 [INFO] Validating code requirements...
2025-10-29 14:37:01 [INFO] Code validation successful.
2025-10-29 14:37:01 [INFO] Cleaning the generated code...
2025-10-29 14:37:01 [INFO] Executing code: import pandas as pd
sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
), ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY count DESC) AS rn
    FROM device_counts
)
SELECT country, device_type, count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""
df_popular_devices = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_popular_devices}
2025-10-29 14:37:01 [INFO] Response generated successfully.
2025-10-29 14:37:31 [INFO] Question: What is the most popular device type per country?
2025-10-29 14:37:31 [INFO] Running PandasAI with litellm LLM...
2025-10-29 14:37:31 [INFO] Prompt ID: 60981955-a31c-46e6-a47f-4912874ac137
2025-10-29 14:37:31 [INFO] Generating new code...
2025-10-29 14:37:34 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 14:37:37 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) as user_count
FROM users
GROUP BY country, device_type
ORDER BY country, user_count DESC
"""

df = execute_sql_query(sql_query)

# For each country, find the device_type with max count
idx = df.groupby('country')['user_count'].idxmax()
most_popular_device_per_country = df.loc[idx].reset_index(drop=True)

result = {"type": "dataframe", "value": most_popular_device_per_country}
2025-10-29 14:37:37 [INFO] Validating code requirements...
2025-10-29 14:37:37 [INFO] Code validation successful.
2025-10-29 14:37:37 [INFO] Cleaning the generated code...
2025-10-29 14:37:37 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) as user_count
FROM users
GROUP BY country, device_type
ORDER BY country, user_count DESC
"""
df = execute_sql_query(sql_query)
idx = df.groupby('country')['user_count'].idxmax()
most_popular_device_per_country = df.loc[idx].reset_index(drop=True)
result = {'type': 'dataframe', 'value': most_popular_device_per_country}
2025-10-29 14:37:38 [INFO] Response generated successfully.
2025-10-29 14:51:15 [INFO] Question: What is the most popular device type per country?
2025-10-29 14:51:15 [INFO] Running PandasAI with litellm LLM...
2025-10-29 14:51:15 [INFO] Prompt ID: f0656a3e-8c83-4ad2-9dd3-a6058e578b27
2025-10-29 14:51:15 [INFO] Generating new code...
2025-10-29 14:51:15 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 14:51:18 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = { "type": "dataframe", "value": df }
2025-10-29 14:51:18 [INFO] Validating code requirements...
2025-10-29 14:51:18 [INFO] Code validation successful.
2025-10-29 14:51:18 [INFO] Cleaning the generated code...
2025-10-29 14:51:18 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-29 14:51:18 [INFO] Response generated successfully.
2025-10-29 14:51:18 [INFO] Question: What is the most popular device type per country?
2025-10-29 14:51:18 [INFO] Running PandasAI with litellm LLM...
2025-10-29 14:51:18 [INFO] Prompt ID: ffb778a6-1f4d-4121-a710-8fc74ba28392
2025-10-29 14:51:18 [INFO] Generating new code...
2025-10-29 14:51:21 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 14:51:24 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) AS user_count
FROM users
GROUP BY country, device_type
ORDER BY country, user_count DESC
"""

df = execute_sql_query(sql_query)

# For each country, keep only the device_type with the max user_count
idx = df.groupby('country')['user_count'].idxmax()
most_popular_devices = df.loc[idx].reset_index(drop=True)

result = { "type": "dataframe", "value": most_popular_devices }
2025-10-29 14:51:24 [INFO] Validating code requirements...
2025-10-29 14:51:24 [INFO] Code validation successful.
2025-10-29 14:51:24 [INFO] Cleaning the generated code...
2025-10-29 14:51:24 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS user_count
FROM users
GROUP BY country, device_type
ORDER BY country, user_count DESC
"""
df = execute_sql_query(sql_query)
idx = df.groupby('country')['user_count'].idxmax()
most_popular_devices = df.loc[idx].reset_index(drop=True)
result = {'type': 'dataframe', 'value': most_popular_devices}
2025-10-29 14:51:26 [INFO] Response generated successfully.
2025-10-29 15:00:50 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:00:50 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:00:50 [INFO] Prompt ID: ca9bb6ea-8540-4a81-93ba-7a42084d899e
2025-10-29 15:00:50 [INFO] Generating new code...
2025-10-29 15:00:50 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:00:58 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Define the SQL query to find the most popular device type per country
sql_query = """
SELECT country, device_type, cnt FROM (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS cnt,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rn
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) WHERE rn = 1
ORDER BY country
"""

# Execute the query using the provided function
df_result = execute_sql_query(sql_query)

# Declare result variable
result = { "type": "dataframe", "value": df_result }
2025-10-29 15:00:58 [INFO] Validating code requirements...
2025-10-29 15:00:58 [INFO] Code validation successful.
2025-10-29 15:00:58 [INFO] Cleaning the generated code...
2025-10-29 15:00:58 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, cnt FROM (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS cnt,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rn
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) WHERE rn = 1
ORDER BY country
"""
df_result = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_result}
2025-10-29 15:00:58 [INFO] Response generated successfully.
2025-10-29 15:03:38 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:03:38 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:03:38 [INFO] Prompt ID: 7c23e7b1-9968-4a55-a72a-a5e43e60c33f
2025-10-29 15:03:38 [INFO] Generating new code...
2025-10-29 15:03:38 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:03:41 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) AS total_users
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY total_users DESC) = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = { "type": "dataframe", "value": df }
2025-10-29 15:03:41 [INFO] Validating code requirements...
2025-10-29 15:03:41 [INFO] Code validation successful.
2025-10-29 15:03:41 [INFO] Cleaning the generated code...
2025-10-29 15:03:41 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS total_users
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY total_users DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-29 15:03:41 [INFO] Response generated successfully.
2025-10-29 15:03:41 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:03:41 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:03:41 [INFO] Prompt ID: 6dc7c91a-5715-4242-8437-bbc8baaa67e0
2025-10-29 15:03:41 [INFO] Generating new code...
2025-10-29 15:03:41 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS total_users
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY total_users DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:03:45 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

# SQL query to get distribution of users per device type
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)

# Plot bar chart
plt.figure(figsize=(8,5))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.tight_layout()
plt.savefig("device_type_distribution.png")
plt.close()

result = {"type": "plot", "value": "device_type_distribution.png"}
2025-10-29 15:03:45 [INFO] Validating code requirements...
2025-10-29 15:03:45 [INFO] Code validation successful.
2025-10-29 15:03:45 [INFO] Cleaning the generated code...
2025-10-29 15:03:45 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_7bf8cfb5-954a-4070-b2a8-a08340211c14.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_7bf8cfb5-954a-4070-b2a8-a08340211c14.png'}
2025-10-29 15:03:45 [INFO] Response generated successfully.
2025-10-29 15:03:45 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:03:45 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:03:45 [INFO] Prompt ID: 6ddc7675-a9fe-46c4-8bce-fae036601f3a
2025-10-29 15:03:45 [INFO] Generating new code...
2025-10-29 15:03:48 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:03:50 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Write code here
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""

df = execute_sql_query(sql_query)

# Get the most popular device type per country by picking first row for each country after ordering
most_popular = df.groupby('country').first().reset_index()

# Declare result var:
result = { "type": "dataframe", "value": most_popular }
2025-10-29 15:03:50 [INFO] Validating code requirements...
2025-10-29 15:03:50 [INFO] Code validation successful.
2025-10-29 15:03:50 [INFO] Cleaning the generated code...
2025-10-29 15:03:50 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""
df = execute_sql_query(sql_query)
most_popular = df.groupby('country').first().reset_index()
result = {'type': 'dataframe', 'value': most_popular}
2025-10-29 15:03:52 [INFO] Response generated successfully.
2025-10-29 15:05:48 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:05:48 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:05:48 [INFO] Prompt ID: 3e6c59dc-bbaf-462d-9550-2ea186f31867
2025-10-29 15:05:48 [INFO] Generating new code...
2025-10-29 15:05:48 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:05:51 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = { "type": "dataframe", "value": df }
2025-10-29 15:05:51 [INFO] Validating code requirements...
2025-10-29 15:05:51 [INFO] Code validation successful.
2025-10-29 15:05:51 [INFO] Cleaning the generated code...
2025-10-29 15:05:51 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-29 15:05:51 [INFO] Response generated successfully.
2025-10-29 15:05:51 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:05:51 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:05:51 [INFO] Prompt ID: 5f18096e-e85d-4157-a821-947e74cb4870
2025-10-29 15:05:51 [INFO] Generating new code...
2025-10-29 15:05:51 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:05:55 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

# SQL query to get the count of users per device type
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)

# Plotting the bar chart
plt.figure(figsize=(8, 6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig("device_type_distribution.png")
plt.close()

result = {"type": "plot", "value": "device_type_distribution.png"}
2025-10-29 15:05:55 [INFO] Validating code requirements...
2025-10-29 15:05:55 [INFO] Code validation successful.
2025-10-29 15:05:55 [INFO] Cleaning the generated code...
2025-10-29 15:05:55 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_8c8c7040-d024-4743-8588-9d5673cdf354.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_8c8c7040-d024-4743-8588-9d5673cdf354.png'}
2025-10-29 15:05:55 [INFO] Response generated successfully.
2025-10-29 15:06:05 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:06:05 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:06:05 [INFO] Prompt ID: fb8fe388-b709-41c6-aa3d-522b0aba2a47
2025-10-29 15:06:05 [INFO] Generating new code...
2025-10-29 15:06:05 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_8c8c7040-d024-4743-8588-9d5673cdf354.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_8c8c7040-d024-4743-8588-9d5673cdf354.png'}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:06:09 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT country, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['country'], df['user_count'], color='lightgreen')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_c6648645-a5b8-48e2-b4f9-37db1e6264bb.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_c6648645-a5b8-48e2-b4f9-37db1e6264bb.png'}
2025-10-29 15:06:09 [INFO] Validating code requirements...
2025-10-29 15:06:09 [INFO] Code validation successful.
2025-10-29 15:06:09 [INFO] Cleaning the generated code...
2025-10-29 15:06:09 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT country, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['country'], df['user_count'], color='lightgreen')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_6651c5fe-3b72-435c-8f2e-7d510bbf3488.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_6651c5fe-3b72-435c-8f2e-7d510bbf3488.png'}
2025-10-29 15:06:09 [INFO] Response generated successfully.
2025-10-29 15:06:14 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:06:14 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:06:14 [INFO] Prompt ID: 9f224a61-0798-4ec2-ac29-b8be534fe05f
2025-10-29 15:06:14 [INFO] Generating new code...
2025-10-29 15:06:14 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT country, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['country'], df['user_count'], color='lightgreen')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_6651c5fe-3b72-435c-8f2e-7d510bbf3488.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_6651c5fe-3b72-435c-8f2e-7d510bbf3488.png'}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:06:18 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)

plt.figure(figsize=(8, 6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_device_type.png')
plt.close()

result = {'type': 'plot', 'value': 'exports/charts/temp_chart_device_type.png'}
2025-10-29 15:06:18 [INFO] Validating code requirements...
2025-10-29 15:06:18 [INFO] Code validation successful.
2025-10-29 15:06:18 [INFO] Cleaning the generated code...
2025-10-29 15:06:18 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_305d6ab1-f506-473a-ac30-5fbf3c4f20e7.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_305d6ab1-f506-473a-ac30-5fbf3c4f20e7.png'}
2025-10-29 15:06:18 [INFO] Response generated successfully.
2025-10-29 15:07:57 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:07:57 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:07:57 [INFO] Prompt ID: ddcca4ec-7b97-453c-b620-3c265262f1d6
2025-10-29 15:07:57 [INFO] Generating new code...
2025-10-29 15:07:57 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:08:00 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = { "type": "dataframe", "value": df }
2025-10-29 15:08:00 [INFO] Validating code requirements...
2025-10-29 15:08:00 [INFO] Code validation successful.
2025-10-29 15:08:00 [INFO] Cleaning the generated code...
2025-10-29 15:08:00 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-29 15:08:00 [INFO] Response generated successfully.
2025-10-29 15:08:00 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:08:00 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:08:00 [INFO] Prompt ID: b73c1222-5413-4f88-94cf-79bf34c9f51f
2025-10-29 15:08:00 [INFO] Generating new code...
2025-10-29 15:08:00 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = """
SELECT country, device_type, COUNT(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:08:04 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)

# Plotting bar chart
plt.figure(figsize=(8,6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig("device_type_distribution.png")
plt.close()

result = {"type": "plot", "value": "device_type_distribution.png"}
2025-10-29 15:08:04 [INFO] Validating code requirements...
2025-10-29 15:08:04 [INFO] Code validation successful.
2025-10-29 15:08:04 [INFO] Cleaning the generated code...
2025-10-29 15:08:04 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_0bd5e8af-7b81-45d4-8915-38320a9ef8b0.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_0bd5e8af-7b81-45d4-8915-38320a9ef8b0.png'}
2025-10-29 15:08:04 [INFO] Response generated successfully.
2025-10-29 15:09:03 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:09:03 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:09:03 [INFO] Prompt ID: 6f5b1cc5-2da2-48d1-af5b-06f1ff66a424
2025-10-29 15:09:03 [INFO] Generating new code...
2025-10-29 15:09:03 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:09:06 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to find the most popular device type per country
sql_query = """
SELECT country, device_type, count(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""

# Execute the query and get the result as a dataframe
df_result = execute_sql_query(sql_query)

# Declare the result variable
result = { "type": "dataframe", "value": df_result }
2025-10-29 15:09:06 [INFO] Validating code requirements...
2025-10-29 15:09:06 [INFO] Code validation successful.
2025-10-29 15:09:06 [INFO] Cleaning the generated code...
2025-10-29 15:09:06 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, count(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df_result = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_result}
2025-10-29 15:09:06 [INFO] Response generated successfully.
2025-10-29 15:09:06 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:09:07 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:09:07 [INFO] Prompt ID: d46ae2f8-b69f-4e57-86eb-d444e383aac6
2025-10-29 15:09:07 [INFO] Generating new code...
2025-10-29 15:09:07 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = """
SELECT country, device_type, count(*) AS device_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country, device_type
QUALIFY ROW_NUMBER() OVER (PARTITION BY country ORDER BY device_count DESC) = 1
ORDER BY country
"""
df_result = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_result}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:09:14 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

# Query to get the count of users per device type
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""

# Execute the query and get the data
df_result = execute_sql_query(sql_query)

# Plotting the bar chart
plt.figure(figsize=(8,6))
plt.bar(df_result['device_type'], df_result['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()

# Save the plot to a file
plot_file = "device_type_distribution.png"
plt.savefig(plot_file)
plt.close()

result = {"type": "plot", "value": plot_file}
2025-10-29 15:09:14 [INFO] Validating code requirements...
2025-10-29 15:09:14 [INFO] Code validation successful.
2025-10-29 15:09:14 [INFO] Cleaning the generated code...
2025-10-29 15:09:14 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df_result = execute_sql_query(sql_query)
plt.figure(figsize=(8, 6))
plt.bar(df_result['device_type'], df_result['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plot_file = 'exports/charts/temp_chart_4541b1d9-b0a7-4f3f-851a-16d77ba7840d.png'
plt.savefig(plot_file)
plt.close()
result = {'type': 'plot', 'value': plot_file}
2025-10-29 15:09:14 [INFO] Response generated successfully.
2025-10-29 15:09:14 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:09:14 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:09:14 [INFO] Prompt ID: 334e5798-d40f-41a4-af34-56b149f2162c
2025-10-29 15:09:14 [INFO] Generating new code...
2025-10-29 15:09:18 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:09:20 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to find the most popular device type per country
sql_query = """
SELECT country, device_type, count(*) as device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""

# Execute the query and load results into a dataframe
df = execute_sql_query(sql_query)

# For each country, keep only the top device type by count
df_most_popular = df.groupby('country').first().reset_index()

# Declare result variable
result = { "type": "dataframe", "value": df_most_popular }
2025-10-29 15:09:20 [INFO] Validating code requirements...
2025-10-29 15:09:20 [INFO] Code validation successful.
2025-10-29 15:09:20 [INFO] Cleaning the generated code...
2025-10-29 15:09:20 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, count(*) as device_count
FROM users
GROUP BY country, device_type
ORDER BY country, device_count DESC
"""
df = execute_sql_query(sql_query)
df_most_popular = df.groupby('country').first().reset_index()
result = {'type': 'dataframe', 'value': df_most_popular}
2025-10-29 15:09:21 [INFO] Response generated successfully.
2025-10-29 15:20:24 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:20:24 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:20:24 [INFO] Prompt ID: 521e36b1-862c-4438-afa4-b8a3db879c3f
2025-10-29 15:20:24 [INFO] Generating new code...
2025-10-29 15:20:24 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:20:28 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# SQL query to find the most popular device type per country
sql_query = """
SELECT country, device_type, total_count FROM (
    SELECT
        country,
        device_type,
        COUNT(*) AS total_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rn
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) sub
WHERE rn = 1
ORDER BY country
"""

# Execute the query
df_result = execute_sql_query(sql_query)

# Declare result var
result = { "type": "dataframe", "value": df_result }
2025-10-29 15:20:28 [INFO] Validating code requirements...
2025-10-29 15:20:28 [INFO] Code validation successful.
2025-10-29 15:20:28 [INFO] Cleaning the generated code...
2025-10-29 15:20:28 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, total_count FROM (
    SELECT
        country,
        device_type,
        COUNT(*) AS total_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rn
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) sub
WHERE rn = 1
ORDER BY country
"""
df_result = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_result}
2025-10-29 15:20:28 [INFO] Response generated successfully.
2025-10-29 15:20:28 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:20:28 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:20:28 [INFO] Prompt ID: d4dffd42-b763-4f07-876a-f455c1a14767
2025-10-29 15:20:28 [INFO] Generating new code...
2025-10-29 15:20:28 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = """
SELECT country, device_type, total_count FROM (
    SELECT
        country,
        device_type,
        COUNT(*) AS total_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rn
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
) sub
WHERE rn = 1
ORDER BY country
"""
df_result = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df_result}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:20:33 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

# SQL query to get count of users grouped by device_type
sql_query = """
SELECT device_type, COUNT(*) as user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df_result = execute_sql_query(sql_query)

# Plotting bar chart for distribution of users per device type
plt.figure(figsize=(8, 5))
plt.bar(df_result['device_type'], df_result['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig("device_type_distribution.png")
plt.close()

result = {"type": "plot", "value": "device_type_distribution.png"}
2025-10-29 15:20:33 [INFO] Validating code requirements...
2025-10-29 15:20:33 [INFO] Code validation successful.
2025-10-29 15:20:33 [INFO] Cleaning the generated code...
2025-10-29 15:20:33 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) as user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df_result = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df_result['device_type'], df_result['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_60a00065-2792-4173-942c-5ad47b14c941.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_60a00065-2792-4173-942c-5ad47b14c941.png'}
2025-10-29 15:20:33 [INFO] Response generated successfully.
2025-10-29 15:20:34 [INFO] Question: [Ask your question here]
2025-10-29 15:20:34 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:20:34 [INFO] Prompt ID: 8ef7ad55-6b50-485e-9546-fd84b1d256eb
2025-10-29 15:20:34 [INFO] Generating new code...
2025-10-29 15:20:34 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT device_type, COUNT(*) as user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df_result = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df_result['device_type'], df_result['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_60a00065-2792-4173-942c-5ad47b14c941.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_60a00065-2792-4173-942c-5ad47b14c941.png'}



### QUERY
 [Ask your question here]

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:20:38 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

# SQL query to count users per country
sql_query = """
SELECT country, COUNT(*) as user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""

# Execute the SQL query
df_result = execute_sql_query(sql_query)

# Plotting the distribution of users per country
plt.figure(figsize=(8, 5))
plt.bar(df_result['country'], df_result['user_count'], color='green')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()

# Save plot to file
plt.savefig('exports/charts/temp_chart_country_distribution.png')
plt.close()

# Return result dictionary with plot information
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_country_distribution.png'}
2025-10-29 15:20:38 [INFO] Validating code requirements...
2025-10-29 15:20:38 [INFO] Code validation successful.
2025-10-29 15:20:38 [INFO] Cleaning the generated code...
2025-10-29 15:20:38 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT country, COUNT(*) as user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""
df_result = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df_result['country'], df_result['user_count'], color='green')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_b2d530c0-b27f-467c-a89b-4629c6840c95.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_b2d530c0-b27f-467c-a89b-4629c6840c95.png'}
2025-10-29 15:20:38 [INFO] Response generated successfully.
2025-10-29 15:22:29 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:22:29 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:22:29 [INFO] Prompt ID: 033a9c41-6b58-4596-b13a-8ae751e54a05
2025-10-29 15:22:29 [INFO] Generating new code...
2025-10-29 15:22:29 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:22:34 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
),
ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY count DESC) AS rn
    FROM device_counts
)
SELECT 
    country, 
    device_type, 
    count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""

df = execute_sql_query(sql_query)

result = {"type": "dataframe", "value": df}
2025-10-29 15:22:34 [INFO] Validating code requirements...
2025-10-29 15:22:34 [INFO] Code validation successful.
2025-10-29 15:22:34 [INFO] Cleaning the generated code...
2025-10-29 15:22:34 [INFO] Executing code: import pandas as pd
sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
),
ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY count DESC) AS rn
    FROM device_counts
)
SELECT 
    country, 
    device_type, 
    count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-10-29 15:22:34 [INFO] Response generated successfully.
2025-10-29 15:22:34 [INFO] Question: Plot a bar chart showing the distribution of users per device type
2025-10-29 15:22:34 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:22:34 [INFO] Prompt ID: 8504bd64-65ac-4e8f-8c3a-6e1051fe2e5f
2025-10-29 15:22:34 [INFO] Generating new code...
2025-10-29 15:22:34 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
sql_query = """
WITH device_counts AS (
    SELECT 
        country, 
        device_type, 
        COUNT(*) AS count
    FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
    GROUP BY country, device_type
),
ranked_devices AS (
    SELECT 
        country, 
        device_type, 
        count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY count DESC) AS rn
    FROM device_counts
)
SELECT 
    country, 
    device_type, 
    count
FROM ranked_devices
WHERE rn = 1
ORDER BY country
"""
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}



### QUERY
 Plot a bar chart showing the distribution of users per device type

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:22:37 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

sql_query = """
SELECT 
    device_type,
    COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)

# Plotting bar chart
plt.figure(figsize=(8,5))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('device_type_distribution.png')
plt.close()

result = {"type": "plot", "value": "device_type_distribution.png"}
2025-10-29 15:22:37 [INFO] Validating code requirements...
2025-10-29 15:22:37 [INFO] Code validation successful.
2025-10-29 15:22:37 [INFO] Cleaning the generated code...
2025-10-29 15:22:37 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT 
    device_type,
    COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_1f87daab-9849-4517-b003-29287755985f.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_1f87daab-9849-4517-b003-29287755985f.png'}
2025-10-29 15:22:37 [INFO] Response generated successfully.
2025-10-29 15:22:37 [INFO] Question: [Ask your question here]
2025-10-29 15:22:37 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:22:37 [INFO] Prompt ID: a0e04275-8613-4a68-aed5-1420ff433b4e
2025-10-29 15:22:37 [INFO] Generating new code...
2025-10-29 15:22:38 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_359ae47edc2130b93b43d6a8a9ad5e3b" columns="[{"name": "user_id", "type": "integer", "description": null, "expression": null, "alias": null}, {"name": "signup_date", "type": "datetime", "description": null, "expression": null, "alias": null}, {"name": "country", "type": "string", "description": null, "expression": null, "alias": null}, {"name": "device_type", "type": "string", "description": null, "expression": null, "alias": null}]" dimensions="1000x4">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Last code generated:
import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT 
    device_type,
    COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY device_type
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df['device_type'], df['user_count'], color='skyblue')
plt.xlabel('Device Type')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Device Type')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_1f87daab-9849-4517-b003-29287755985f.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_1f87daab-9849-4517-b003-29287755985f.png'}



### QUERY
 [Ask your question here]

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:22:41 [INFO] Code Generated:
import pandas as pd
import matplotlib.pyplot as plt

sql_query = """
SELECT 
    country,
    COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""

df = execute_sql_query(sql_query)

plt.figure(figsize=(8, 5))
plt.bar(df['country'], df['user_count'], color='lightgreen')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_country_distribution.png')
plt.close()

result = {'type': 'plot', 'value': 'exports/charts/temp_chart_country_distribution.png'}
2025-10-29 15:22:41 [INFO] Validating code requirements...
2025-10-29 15:22:41 [INFO] Code validation successful.
2025-10-29 15:22:41 [INFO] Cleaning the generated code...
2025-10-29 15:22:41 [INFO] Executing code: import pandas as pd
import matplotlib.pyplot as plt
sql_query = """
SELECT 
    country,
    COUNT(*) AS user_count
FROM table_359ae47edc2130b93b43d6a8a9ad5e3b
GROUP BY country
ORDER BY user_count DESC
"""
df = execute_sql_query(sql_query)
plt.figure(figsize=(8, 5))
plt.bar(df['country'], df['user_count'], color='lightgreen')
plt.xlabel('Country')
plt.ylabel('Number of Users')
plt.title('Distribution of Users per Country')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('exports/charts/temp_chart_cb9244f9-ccf4-474b-b7bb-e79853b9e43d.png')
plt.close()
result = {'type': 'plot', 'value': 'exports/charts/temp_chart_cb9244f9-ccf4-474b-b7bb-e79853b9e43d.png'}
2025-10-29 15:22:41 [INFO] Response generated successfully.
2025-10-29 15:22:41 [INFO] Question: What is the most popular device type per country?
2025-10-29 15:22:41 [INFO] Running PandasAI with litellm LLM...
2025-10-29 15:22:41 [INFO] Prompt ID: f3d27457-2cde-45c6-8969-d576d676f558
2025-10-29 15:22:41 [INFO] Generating new code...
2025-10-29 15:22:44 [INFO] Using Prompt: <tables>

<table dialect="postgres" table_name="users" description="Users table from PostgreSQL database" dimensions="20000x0">
user_id,signup_date,country,device_type
1,2024-06-02,Rest,iOS
2,2024-03-20,India,Android
3,2023-09-17,EU,Web
4,2024-02-05,India,iOS
5,2025-06-08,India,Web
</table>


</tables>

The following functions have already been provided. Please use them as needed and do not redefine them.
<function>
def execute_sql_query(sql_query: str) -> pd.DataFrame
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>



Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the most popular device type per country?

At the end, declare "result" variable as a dictionary of type and value in the following format:

type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }



Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-10-29 15:22:47 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Write code here
sql_query = """
SELECT country, device_type, count(*) AS user_count
FROM users
GROUP BY country, device_type
ORDER BY country, user_count DESC
"""

df = execute_sql_query(sql_query)

# Extract the most popular device type per country
# We can use pandas groupby and head(1) to get the device type with max count per country
most_popular_device_per_country = df.groupby('country').head(1).reset_index(drop=True)

result = { "type": "dataframe", "value": most_popular_device_per_country }
2025-10-29 15:22:47 [INFO] Validating code requirements...
2025-10-29 15:22:47 [INFO] Code validation successful.
2025-10-29 15:22:47 [INFO] Cleaning the generated code...
2025-10-29 15:22:47 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, device_type, count(*) AS user_count
FROM users
GROUP BY country, device_type
ORDER BY country, user_count DESC
"""
df = execute_sql_query(sql_query)
most_popular_device_per_country = df.groupby('country').head(1).reset_index(drop=True)
result = {'type': 'dataframe', 'value': most_popular_device_per_country}
2025-10-29 15:22:49 [INFO] Response generated successfully.
